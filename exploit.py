import time
import subprocess as sp
import sys

SAMPLES = 10
ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"

def run_server(secret):
    start = time.perf_counter()
    ret = sp.call(["./server", secret], stdout=sp.DEVNULL)
    end = time.perf_counter()

    return ret, (end - start)

def sample(secret, times):
    ret = None
    total_time = 0
    for i in range(0, times):
        ret, time = run_server(secret)
        total_time += time

    return ret, (total_time / times)

def guess(prefix):
    guess_to_time = {}
    for char in ALPHABET:
        g = prefix + char

        ret, t = sample(g, SAMPLES)
        if ret == 0:
            print("Found: ", g)
            sys.exit()

        guess_to_time[char] = t

    best_guess = None
    best_guess_time = 0
    for (char, t) in guess_to_time.items():
        if t > best_guess_time:
            best_guess = char
            best_guess_time = t

    return best_guess

current = ""
while True:
    guessed_char = guess(current)
    current = current + guessed_char
    print(current)
